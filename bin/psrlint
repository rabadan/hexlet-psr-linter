#!/usr/bin/env php

<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Commando\Command;
use HexletPsrLinter\Report\Report;
use function HexletPsrLinter\linter;
use function HexletPsrLinter\fileLinter;
use function HexletPsrLinter\printCli;

$cmd = new Command();
$cmd->option()
    ->aka('path')
    ->require()
    ->describedAs('File path');

$cmd->option('format')
    ->aka('f')
    ->description('Report file format [options: txt, json, yml] [default: txt]')
    ->must(function ($format) {
        return in_array($format, ['txt', 'json', 'yml']);
    })
    ->default('txt');

$cmd->option('fix')
    ->description('Auto fix names (my_var_name -> MyVarName)')
    ->boolean();

$exitCode = 0;

$resultLint = fileLinter(linter(), $cmd['path'], $cmd['fix']);

$report = new Report($resultLint, $cmd['format']);

if (!$report->isEmpty()) {
    $exitCode = 1;
    printCli($report->getLogs());
}

exit($exitCode);
